# vim: ft=sh

# Bootstrap definitions won't use grind API
# because they might not work until the bootstrap
# is finished.

echo "Review definitions/bootstrap and remove this line to enable it."; exit 1;

set -e

function install_homebrew() {
  echo "Installing homebrew"
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
}

function xcode_cli_installed() {
  pkgutil --pkg-info=com.apple.pkg.CLTools_Executables > /dev/null
}

function xcode_cli_install() {
  echo "Installing XCode CLI Tools"
  xcode-select --install
  echo "Press return after XCode CLI installation"
  read
}

# Install XCode CLI Tools
echo "Check if XCode CLI Tools is installed"
xcode_cli_installed || xcode_cli_install

# Install Homebrew if XCode is present
if [[ $(xcode_cli_installed) -eq 0 ]]; then
  [[ -d "/usr/local/Homebrew" ]] || install_homebrew
fi

# If bash is lower than version 4
# grind won't work.
if [[ ${BASH_VERSION%%.*} -lt 4 ]]; then
  echo "Bash version is too old, installing a newer version."
  brew install bash
fi
